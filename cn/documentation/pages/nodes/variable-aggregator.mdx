---
title: "变量聚合器"
icon: "merge"
---

<Note> ⚠️ 本文档由 AI 自动翻译。如有任何不准确之处，请参考[英文原版](/en/documentation/pages/nodes/variable-aggregator)。</Note>


变量聚合器节点将来自不同执行路径的变量组合成单一的统一输出。当多个分支产生相似输出时，该节点通过创建一个一致的变量引用，消除了对重复下游处理的需求。

## 分支问题

条件工作流创建并行执行路径，其中每次只有一个分支运行。没有聚合的情况下，你需要为每个可能的分支结果设置重复的下游节点，这会创建复杂且难以维护的工作流。

变量聚合器充当合并点，将分支输出收集到单个变量中，下游节点可以一致地引用该变量，无论实际执行的是哪个分支。

## 分类工作流示例

当用户输入被分类且每个类别需要不同的知识检索时，变量聚合器将结果组合：

**无聚合** - 需要重复大型语言模型节点的复杂工作流：

<Frame caption="没有变量聚合的复杂工作流">
  <img src="https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/workflow/node/7a7c91663c3799ce9d056b013d5df29c.png" alt="Issue Classification without Variable Aggregation" />
</Frame>

**有聚合** - 使用单一下游处理的简化工作流：

<Frame caption="使用变量聚合的简化工作流">
  <img src="https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/workflow/node/2b1694936fdab4843f5edc3f2fd1e79a.png" alt="Multi-Branch Aggregation after Issue Classification" />
</Frame>

聚合的工作流使用一个大型语言模型节点，而不是为每个分类分支重复设置，显著降低了复杂性，同时保持相同的功能。

## 条件处理示例

对于产生类似输出的If-Else分支，也有类似的好处：

<Frame caption="条件分支后的变量聚合">
  <img src="https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/workflow/node/ff0e5774a3eccc8a04c310ab9bae25e7.png" alt="Multi-Branch Aggregation after Conditional Branching" />
</Frame>

## 配置

### 变量选择

连接来自不同工作流分支的变量，你希望将这些变量组合。每个连接的变量都成为聚合输出的潜在输入。

### 类型约束

**相同类型规则** - 所有聚合的变量必须是相同的数据类型。一旦你连接第一个变量（例如字符串），节点只接受来自其他分支的相同类型变量。

**支持的类型：**
- **String** - 来自不同处理分支的文本输出
- **Number** - 数值计算、分数或测量值
- **Object** - 具有相似架构的结构化数据对象
- **Array** - 列表、集合或多个结果

### 输出行为

变量聚合器输出实际执行的分支的值。由于在条件工作流中只有一个分支运行，因此在执行期间只有一个输入变量会有值。

## 高级功能

### 多个聚合组

高级工作流（v0.6.10+）可以同时聚合多组变量。每组都保持自己的类型约束，允许你在同一节点内并行聚合不同的数据类型。

这在分支产生需要单独组合的多个相关输出时很有用 - 例如，从不同处理路径聚合文本摘要和数值分数。

## 常见使用案例

**多类别处理** - 不同内容类型需要专门处理，但产生类似的输出，这些输出馈入通用下游逻辑。

**条件数据源** - 不同条件触发不同的知识检索或API调用，但所有结果都需要相同的最终处理。

**分支结果整合** - 复杂的分支逻辑产生各种输出，最终需要统一处理。

**错误处理** - 主处游节点可以一致地处理。

## 最佳实践

**规划数据类型** - 在连接到变量聚合器之前，确保所有分支都产生兼容的数据类型。

**一致的输出结构** - 聚合对象或数组时，在所有分支中保持一致的结构，以实现可预测的下游处理。

**使用描述性名称** - 清楚地命名聚合变量，以表明它们包含来自多个可能来源的结果。

**测试所有分支** - 验证每个可能的执行路径都产生有效的输出，在聚合时能够正确工作。
