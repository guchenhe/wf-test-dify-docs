---
title: "构建情感分析工作流"
description: "创建一个使用LLM和分类节点分析文本情感的工作流"
icon: "face-smile"
---

<Note> ⚠️ 本文档由 AI 自动翻译。如有任何不准确之处，请参考[英文原版](../../../../en/documentation/pages/tutorials/sentiment-analysis-workflow.mdx)。</Note>

学习如何构建一个情感分析工作流，将文本分类为积极、消极或中性。

## 概述

本教程指导您创建一个工作流，它可以：
- 接受用户的文本输入
- 使用LLM分析情感
- 将结果分类为不同类别
- 返回结构化的情感数据

## 前提条件

- 对Dify工作流的基本理解
- 访问LLM模型的权限（GPT-4、Claude等）
- 熟悉提示词工程

## 步骤1：设置工作流

### 创建新工作流
1. 在侧边栏中导航到**工作流**
2. 点击**创建工作流**
3. 命名为"情感分析"
4. 选择**Chatflow**类型

### 添加开始节点
开始节点应该接受文本输入：

```yaml
Input Variables:
  - text_to_analyze (string, required)
  - language (string, optional, default: "en")
```

## 步骤2：添加LLM节点进行分析

### 配置LLM节点
添加一个LLM节点来分析情感：

**系统提示词：**
```
You are a sentiment analysis expert. Analyze the given text and determine:
1. Overall sentiment (positive, negative, neutral)
2. Confidence score (0-100)
3. Key emotional indicators

Return your analysis in JSON format:
{
  "sentiment": "positive|negative|neutral",
  "confidence": 85,
  "emotions": ["joy", "excitement"],
  "reasoning": "Brief explanation"
}
```

**用户提示词：**
```
Analyze the sentiment of this text in {{language}}:

{{text_to_analyze}}
```

## 步骤3：添加问题分类器

### 设置分类
添加一个问题分类器节点，根据情感进行路由：

**类别：**
- **积极**：置信度 > 70 且情感 = "positive"
- **消极**：置信度 > 70 且情感 = "negative"
- **中性**：所有其他情况

### 分类逻辑
```
IF sentiment == "positive" AND confidence > 70:
  → Route to positive_response
ELIF sentiment == "negative" AND confidence > 70:
  → Route to negative_response
ELSE:
  → Route to neutral_response
```

## 步骤4：创建响应模板

### 积极响应模板
```markdown
✅ **检测到积极情感** ({{confidence}}% 置信度)

您的文本表达了积极情感，特别是：{{emotions}}

**分析：** {{reasoning}}
```

### 消极响应模板
```markdown
⚠️ **检测到消极情感** ({{confidence}}% 置信度)

您的文本表达了消极情感，特别是：{{emotions}}

**分析：** {{reasoning}}
```

### 中性响应模板
```markdown
ℹ️ **中性情感** ({{confidence}}% 置信度)

您的文本看起来是平衡或中性的。

**分析：** {{reasoning}}
```

## 步骤5：添加变量聚合器

合并所有数据用于最终输出：

```json
{
  "input_text": "{{text_to_analyze}}",
  "sentiment": "{{sentiment}}",
  "confidence": {{confidence}},
  "emotions": {{emotions}},
  "reasoning": "{{reasoning}}",
  "timestamp": "{{current_time}}"
}
```

## 步骤6：测试工作流

### 测试用例

**测试1：积极文本**
```
Input: "I absolutely love this product! It exceeded all my expectations."
Expected: Positive sentiment, high confidence
```

**测试2：消极文本**
```
Input: "This service was terrible and I'm very disappointed."
Expected: Negative sentiment, high confidence
```

**测试3：中性文本**
```
Input: "The product arrived on time and matches the description."
Expected: Neutral sentiment
```

## 高级功能增强

### 多语言支持
在情感分析之前添加语言检测：
- 使用语言检测节点
- 路由到特定语言的LLM提示词

### 批量处理
一次处理多个文本：
- 添加迭代节点
- 循环遍历文本数组
- 聚合结果

### 历史跟踪
存储情感数据用于趋势分析：
- 添加HTTP节点将数据发送到数据库
- 创建可视化仪表板
- 跟踪随时间变化的情感

## 故障排除

### 低置信度分数
- 优化您的系统提示词
- 在提示词中提供更多示例
- 使用更强大的LLM模型

### 分类不一致
- 调整置信度阈值
- 添加更多分类类别
- 实施共识投票（多次LLM调用）

## 下一步

- [问题分类器节点](/en/documentation/pages/nodes/question-classifier)
- [LLM节点](/en/documentation/pages/nodes/llm)
- [变量聚合器](/en/documentation/pages/nodes/variable-aggregator)

<Tip>
  将情感分析结果保存到知识库中，以供型微调。
</Tip>