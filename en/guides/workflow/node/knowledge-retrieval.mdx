---
title: Knowledge Retrieval
---

## Introduction

The Knowledge Retrieval node allows you to embed existing knowledge bases into your chatflow or workflow applications. It searches specific knowledge for information relevant to queries and returns contextual content for use in downstream nodes.

Below is an example of using the Knowledge Retrieval node in a chatflow:

1. The **Start** node collects the user query.

2. The **Knowledge Retrieval** node searches the selected knowledge base(s) for content related to the user query and outputs the retrieval results.

3. The **LLM** node generates a response based on both the user query and retrieved knowledge.

4. The **Answer** node returns the LLM's response to the user.

![Knowledge Retrieval Node Use Case]()

<Info>
    Before using the Knowledge Retrieval node, ensure that you have at least one available knowledge base. To learn about creating and managing knowledge bases, see [Knowledge Overview](/en/guides/knowledge-base/readme).
</Info>

## Configuration

To make the Knowledge Retrieval node work, you need to tell it *what* it should search for (the query) and *where* it should search (the knowledge base). 

[You can also adjust retrieval settings to optimize results], or use document metadata to enable filer-based searches and improve retrieval precision.

### Specify the Query Variable and Attachment

Provide the query content that the node should search for in the selected knowledge base(s).

- **Query Variable**: Use `sys.query` to reference user input in chatflow applications, or select any text variable from preceding nodes. Query text is limited to 200 characters.

- **Query Attachment**(optional): Reference an image variable to search by image, such as the image uploaded by the user through the Start node.

    <Info>
        To enable image-based retrieval, add at least one knowledge base marked with an **Image** icon, which indicates that it uses an embedding model supporting image vectorization.
    </Info>

### Select Knowledge to Search

Add one or more existing knowledge bases for the node to search for content relevant to the query content.

<Info>
   Knowledge bases marked with an **Image** icon support image-based retrieval.
</Info>

<Tip>
    You can click the **Edit** icon next to any added knowledge base to modify its settings directly within the Knowledge Retrieval node. To learn more about these settings, see [Manage Knowledge](/en/guides/knowledge-base/knowledge-and-documents-maintenance/introduction) and [Select the Indexing Method and Retrieval Setting](/en/guides/knowledge-base/create-knowledge-and-upload-documents/setting-indexing-methods).
</Tip>

### Adjust Retrieval Settings

When multiple knowledge bases are added, you can control how their retrieval results are combined and reranked through **Retrieval Setting**:

- **Rerank Setting**

    - **Weighted Score**: Adjust the relative weight between semantic similarity and keyword matching during reranking. Higher semantic weight favors meaning relevance, while higher keyword weight favors exact matches.

    - **Rerank Model**: Choose a rerank model to re-score and reorder all the results based on their relevance to the query.

- **Top K**: Specify how many top results to return after reranking. When a rerank model is selected, this value is automatically adjusted based on the modelâ€™s maximum token limit (how much text the model can process at once).

- **Score Threshold**: Set the minimum similarity score for returned results. Results scoring below this threshold are excluded. Use higher thresholds (0.7+) for stricter relevance or lower thresholds (0.5-) to include broader matches.

### Enable Metadata Filtering

You can use existing document metadata to restrict retrieval to specific documents within your knowledge, improving retrieval precision.

With metadata filtering enabled, the Knowledge Retrieval node only searches documents that match the specified metadata conditions, rather than searching across the entire knowledge base. This is especially useful for targeted searching in large and diverse knowledge bases.

<Info>
    To learn more about creating and managing document metadata, see [Metadata](/en/guides/knowledge-base/metadata).
</Info>

## Output

The Knowledge Retrieval node outputs the retrieval results as a variable named `result`, which is an array of retrieved document chunks containing their content, metadata, title, and other attributes.

If image-based retrieval is enabled and matching images are found, the node output also includes an additional field named `file` containing the retrieved image details.

![Knowledge Retrieval Node Output]()

## Use with LLM Nodes

To use the retrieval results to answer user questions in an LLM node:

1. In the **Context** field, select the `result` variable of the Knowledge Retrieval node.

2. In the prompt field, reference both the **Context** variable and the user input variable (e.g., `sys.query`).

![LLM Node Configuration Example]()

<Note>
    Knowledge retrieval operations are subject to rate limits based on your subscription plan. For more information, see [Knowledge Request Rate Limit](/en/guides/knowledge-base/knowledge-request-rate-limit).
</Note>
