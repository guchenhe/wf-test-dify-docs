---
title: "知識検索"
description: "関連情報のためにナレッジベースを検索"
icon: "database"
---

<Note> ⚠️ このドキュメントはAIによって自動翻訳されています。不正確な部分がある場合は、[英語版](/en/documentation/pages/nodes/knowledge-retrieval)を参照してください。</Note>


知識検索ノードは知識ベースから関連情報を検索し、下流ノードで使用するためのコンテキストコンテンツを返します。文書から特定の情報を提供することで、RAG（検索拡張生成）アプリケーションを可能にします。

<Frame caption="知識検索ノードの設定">
  <img src="https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/workflow/node/d90961c6d794d425a8e11df177315188.png" alt="Knowledge Retrieval Node Interface" />
</Frame>

<Info>
  このノードを使用する前に知識ベースを作成し、データを投入してください。設定手順については[知識ベース作成ガイド](/en/guides/knowledge-base/create-knowledge-and-upload-documents)を参照してください。
</Info>

## 設定

### クエリと知識ベースの選択

**クエリ**は知識ベースで検索する内容を決定します。チャットフローアプリケーションでのユーザー入力には`sys.query`を使用するか、ワークフローからの任意のテキスト変数を使用してください。クエリは200文字に制限されています。

検索する**知識ベース**を1つ以上選択してください。それぞれにはDifyにアップロードしたインデックス化された文書が含まれています。複数の知識ベースを異なる戦略を使用して同時に検索できます。

### 検索戦略

コンテンツを検索する方法を選択してください：

<Tabs>
  <Tab title="セマンティック検索">
    ベクトル埋め込みを使用して、意味に基づいて概念的に類似するコンテンツを見つけます。自然言語クエリや異なる用語を持つ関連概念に適しています。
  </Tab>
  
  <Tab title="キーワード検索">
    正確な単語マッチングのための従来の全文検索です。特定の用語、コード、または名前に対してより高速で予測可能です。
  </Tab>
  
  <Tab title="ハイブリッド検索">
    セマンティックとキーワードのアプローチを組み合わせます。結果はより良い関連性のために特化したモデルを使用して再ランキングされます。
  </Tab>
</Tabs>

## 高度な設定

<Frame caption="高度な検索設定オプション">
  <img src="https://assets-docs.dify.ai/2025/03/fbd43d558f83b355a1b18ac26a253b84.png" alt="Knowledge retrieval configuration interface" />
</Frame>

### 検索パラメータ

**TopK**は取得する文書チャンクの数を制御します。集中的な結果には3-5チャンクから始めるか、包括的なカバレッジには10-15チャンクを使用してください。

**スコア閾値**は最小類似性スコアを設定します。高い閾値（0.7+）は関連性を保証し、低い閾値（0.5-）はより周辺的なコンテンツを含みます。

**再ランキング**は初期検索後に結果を再スコア化します。ハイブリッド検索、多くのチャンク、または速度よりも精度が重要な場合に有効にしてください。

### メタデータフィルタリング

タイプ、日付、部門などの文書メタデータを使用して結果をフィルタリングします。大きな知識ベースでのターゲット検索を可能にするために、文書をアップロードする際にメタデータを設定してください。

### 複数知識ベース戦略

**N-to-1 Recall**は関数呼び出しを使用してクエリを分析し、適切な知識ベースを選択し、検索を最適化します。異最適です。

**マルチパス検索**は選択されたすべての知識ベースを同時にクエリし、結果を組み合わせます。情報が複数のソースにまたがる場合や包括的なカバレッジが必要な場合に使用してください。

<Frame caption="複数知識ベースの検索戦略の比較">
  <img src="https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/workflow/node/4a3007cda9dfa50ddac3711693725dce.png" alt="Retrieval Mode Comparison" />
</Frame>

## 出力と統合

このノードは、テキストコンテンツとメタデータ（ソース、スコア、文書ID）を含む取得された文書チャンクの配列を出力します。この構造化された出力は引用に必要な情報を保持します。

### RAG統合

RAGアプリケーション用に知識検索出力をLLMノードのコンテキスト入力に接続してください。検索結果をコンテキスト変数として使用する場合、Difyは自動的にソースを追跡し、引用を有効にします。

```text
System: Answer based on the provided context.
Context: {{knowledge_retrieval.result}}
User: {{user_question}}
```

### レート制限

知識検索操作は、サブスクリプションプランに基づいてレート制限の対象となります。システムは60秒のスライディングウィンドウでRedisを使用してリクエストを追跡します。制限を超えると、`RateLimitExceeded`エラーが返されます。

### パフォーマンスの考慮事項

検索品質はインデックス作成の実践に依存します。小さなチャンク（200-500トークン）は精密な検索を可能にし、大きなチャンク（800-1500トークン）はコンテキストを維持します。知識ベースにはレート制限があります - ノードは自動的にスロットリングを処理し、同一のクエリをキャッシュします。
