---
title: "感情分析ワークフローを構築する"
description: "LLMと分類ノードを使用してテキストの感情を分析するワークフローを作成する"
icon: "face-smile"
---

<Note> ⚠️ このドキュメントはAIによって自動翻訳されています。不正確な部分がある場合は、[英語版](../../../../en/documentation/pages/tutorials/sentiment-analysis-workflow.mdx)を参照してください。</Note>

テキストをポジティブ、ネガティブ、またはニュートラルに分類する感情分析ワークフローの構築方法を学びます。

## 概要

このチュートリアルでは、以下の機能を持つワークフローの作成方法をガイドします：
- ユーザーからのテキスト入力を受け取る
- LLMを使用して感情を分析する
- 結果をカテゴリに分類する
- 構造化された感情データを返す

## 前提条件

- Difyワークフローの基本的な理解
- LLMモデルへのアクセス（GPT-4、Claudeなど）
- プロンプトエンジニアリングの知識

## ステップ1：ワークフローのセットアップ

### 新しいワークフローを作成
1. サイドバーの**ワークフロー**に移動する
2. **ワークフローを作成**をクリックする
3. 「感情分析」と名前を付ける
4. **チャットフロー**タイプを選択する

### 開始ノードを追加
開始ノードはテキスト入力を受け取るように設定します：

```yaml
Input Variables:
  - text_to_analyze (string, required)
  - language (string, optional, default: "en")
```

## ステップ2：分析用のLLMノードを追加

### LLMノードの設定
感情を分析するためのLLMノードを追加します：

**システムプロンプト:**
```
You are a sentiment analysis expert. Analyze the given text and determine:
1. Overall sentiment (positive, negative, neutral)
2. Confidence score (0-100)
3. Key emotional indicators

Return your analysis in JSON format:
{
  "sentiment": "positive|negative|neutral",
  "confidence": 85,
  "emotions": ["joy", "excitement"],
  "reasoning": "Brief explanation"
}
```

**ユーザープロンプト:**
```
Analyze the sentiment of this text in {{language}}:

{{text_to_analyze}}
```

## ステップ3：質問分類器を追加

### 分類の設定
感情に基づいてルーティングするための質問分類器ノードを追加します：

**クラス:**
- **ポジティブ**: 信頼度 > 70 かつ 感情 = "positive"
- **ネガティブ**: 信頼度 > 70 かつ 感情 = "negative"
- **ニュートラル**: その他すべてのケース

### 分類ロジック
```
IF sentiment == "positive" AND confidence > 70:
  → Route to positive_response
ELIF sentiment == "negative" AND confidence > 70:
  → Route to negative_response
ELSE:
  → Route to neutral_response
```

## ステップ4：レスポンステンプレートの作成

### ポジティブレスポンステンプレート
```markdown
✅ **ポジティブな感情を検出** ({{confidence}}% 信頼度)

あなたのテキストはポジティブな感情を表現しています。特に: {{emotions}}

**分析:** {{reasoning}}
```

### ネガティブレスポンステンプレート
```markdown
⚠️ **ネガティブな感情を検出** ({{confidence}}% 信頼度)

あなたのテキストはネガティブな感情を表現しています。特に: {{emotions}}

**分析:** {{reasoning}}
```

### ニュートラルレスポンステンプレート
```markdown
ℹ️ **ニュートラルな感情** ({{confidence}}% 信頼度)

あなたのテキストはバランスが取れているか中立的です。

**分析:** {{reasoning}}
```

## ステップ5：変数アグリゲーターを追加

最終出力のためにすべてのデータを結合します：

```json
{
  "input_text": "{{text_to_analyze}}",
  "sentiment": "{{sentiment}}",
  "confidence": {{confidence}},
  "emotions": {{emotions}},
  "reasoning": "{{reasoning}}",
  "timestamp": "{{current_time}}"
}
```

## ステップ6：ワークフローをテストする

### テストケース

**テスト1：ポジティブテキスト**
```
入力: "I absolutely love this product! It exceeded all my expectations."
期待高い信頼度
```

**テスト2：ネガティブテキスト**
```
入力: "This service was terrible and I'm very disappointed."
期待値: ネガティブな感情、高い信頼度
```

**テスト3：ニュートラルテキスト**
```
入力: "The product arrived on time and matches the description."
期待値: ニュートラルな感情
```

## 高度な機能強化

### 多言語サポート
感情分析の前に言語検出を追加：
- 言語検出ノードを使用
- 言語固有のLLMプロンプトにルーティング

### バッチ処理
複数のテキストを一度に処理：
- 反復ノードを追加
- テキストの配列をループ
- 結果を集約

### 履歴追跡
トレンド分析のために感情データを保存：
- HTTPノードを追加してデータをデータベースに送信
- 可視化ダッシュボードを作成
- 時系列での感情を追跡

## トラブルシューティング

### 信頼度スコアが低い場合
- システムプロンプトを改良する
- プロンプトにより多くの例を提供する
- より高性能なLLMモデルを使用する

### 一貫性のない分類
- 信頼度の閾値を調整する
- より多くの分類カテゴリを追加する
- コンセンサス投票を実装（複数のLLM呼び出し）

## 次のステップ

- [質問分類器ノード](/en/documentation/pages/nodes/question-classifier)
- [LLMノード](/en/documentation/pages/nodes/llm)
- [変数アグリゲーターノード](/en/documentation/pages/nodes/variable-aggregator)

<Tip>
  将来の参照とモデルのファインチューニングのために、感情分析結果をナレッジベースに保存してください。
</Tip>